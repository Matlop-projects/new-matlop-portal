<div class="container">
  <div class="d-flex justify-content-center mb-3">
    <button class="btn btn-default w-250" (click)="onRequest()">
      {{ "actions.request" | translate }}
    </button>
  </div>
    <div class="status">
      <span
        [class.active-status]="activeStatus == 'pending'"
        class="btn"
        (click)="onSelectStatus('pending')"
      >
        <span class="name">{{ "ORDERS.PENDING" | translate }}</span>
        <span class="count">{{ ordersCount?.pendingOrdersCount || 0 }}</span>
      </span>
      <span
        [class.active-status]="activeStatus == 'complete'"
        class="btn"
        (click)="onSelectStatus('complete')"
      >
        <span class="name">{{ "ORDERS.COMPLETE" | translate }}</span>
        <span class="count">{{ ordersCount?.completedOrdersCount || 0 }}</span>
      </span>
      <span
        [class.active-status]="activeStatus == 'cancel'"
        class="btn"
        (click)="onSelectStatus('cancel')"
      >
        <span class="name">{{ "ORDERS.CANCEL" | translate }}</span>
        <span class="count">{{ ordersCount?.canceledOrdersCount || 0 }}</span>
      </span>
    </div>
  <div class="orders mt-5">
    <ng-container *ngIf="orders.length > 0; else empty">
      <div class="card mt-3 mb-3" *ngFor="let item of orders">
        <div class="p-4">
          <div class="header d-flex justify-content-between">
            <span class="bold"
              >{{
                currentlang == "en"
                  ? item.specialOrderName
                  : item.specialOrderName
              }}
              <span> - #{{ item.specialOrderId }}</span>
            </span>
            <span [class]="getStatusClass(item.specialOrderStatus)" class="all-status">
              {{ getOrderStatusText(item.specialOrderStatus) }}
              <span class="pi pi-circle-on"></span>
            </span>
          </div>
          <!-- <div class="d-flex justify-content-start">
            <div>
              <span class="bold"> {{ item.orderTotal??0}} </span>
              <span class="text-gray-light">{{
                "ORDERS.SAR" | translate
              }}</span>
            </div>
            <div class="tax">{{ "ORDERS.VAT_INCLUDED" | translate }}</div>
          </div> -->
            <!-- <div class="mt-5 d-flex justify-content-between">
            <span class="bold">{{'PACKAGE_DETAILS.specialOrderDate'|translate}}</span>
            <span>{{item.specialOrderDate | date:'YYYY-MM-dd (HH:mm a)'}} </span>
          </div> -->
          <div class="mt-3 d-flex justify-content-between">
            <span class="bold">{{'PACKAGE_DETAILS.PRICE'|translate}}</span>
            <span>{{item.amount??0}} {{getCurrencyCode() | translate}}</span>
          </div>
              <!-- <div class="mt-3 d-flex justify-content-between">
            <span class="bold">{{'amount'|translate}}</span>
            <span>{{item.amount??0}}</span>
          </div> -->
          <div class="mt-3">
            <span class="bold block">{{ "PACKAGE_DETAILS.MEDIA" | translate }} </span>
           
           <ng-container *ngIf="item.media && item.media.length > 0; else noMedia">
           <div class="mt-2" *ngFor="let mediaItem of item.media">
              <img
                *ngIf="mediaItem.mediaTypeEnum == 1"
                [src]="baseImgUrl + mediaItem.src"
                class="media-image m-1"
                alt="Media Image"
                width="150px"
                height="150px"
              />
              <video
                *ngIf="mediaItem.mediaTypeEnum == 2"
                [src]="baseImgUrl + mediaItem.src"
                class="media-video m-1"
                width="150px"
                height="150px"
                controls
              ></video>
             </div>
          </ng-container>
           <ng-template #noMedia>
             <div class="text-center">
               <span class="bold"> {{ "order_details.no_img" | translate }}</span>
             </div>
           </ng-template>
          </div>
          <div class="mt-3">
            <span class="bold">{{ "order_details.notes" | translate }} </span>

            <span class="bold block text-gray-light">{{ item.notes }} </span>
          </div>
          <!-- <div class="d-flex justify-content-start mt-3">
            <div class="margin-2">
              <span class="name">{{ "ORDERS.VISITS" | translate }}: </span>
              <span class="bold">{{ item.package.visitNumber }} </span>
              <span class="bold">{{ "ORDERS.VISITS_UNIT" | translate }}</span>
            </div>
            <div class="margin-2">
              <span class="name">{{ "ORDERS.HOURS" | translate }}: </span>
              <span class="bold">{{ item.package.visitHours }} </span>
              <span class="bold">{{ "ORDERS.HOURS_UNIT" | translate }}</span>
            </div>
          </div> -->
        </div>
        <div class="details d-flex justify-content-between align-items-center">
          <div class="text-gray-light">
            <span class="time">
              {{ formatDateTime(item.creationTime, "time") }}
              <span class="pi pi-clock"></span>
            </span>
            <span>
              {{ formatDateTime(item.creationTime, "date") }}
              <span class="pi pi-calendar"></span>
            </span>
          </div>
          <div class="pointer offers-btn" (click)="getOffers(item.specialOrderId)">
            <span class="pi pi-gift me-1"></span>
            {{ currentlang === 'ar' ? 'العروض المقدمة' : 'View Offers' }}
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <ng-template #empty>
    <div class="text-center m-5">
      <span class="bold">{{ "ORDERS.NO_ORDERS" | translate }}</span>
    </div>
  </ng-template>
</div>
<app-pagination  [totalCount]="totalCount" (onPageChange)="onPageChange($event)"></app-pagination>

<!-- Offers Dialog -->
<p-dialog
  [(visible)]="showOffersDialog"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90%', maxWidth: '700px' }"
  [header]="currentlang === 'ar' ? 'العروض المقدمة' : 'Available Offers'"
  (onHide)="closeOffersDialog()">
  
  <div class="offers-container">
    <ng-container *ngIf="offers && offers.length > 0; else noOffers">
      <div class="offer-card" *ngFor="let offer of offers">
        <div class="offer-header">
          <h4 class="offer-title">{{ offer.technicalName }}</h4>
          <span class="offer-price">{{ offer.price }} {{ getCurrencyCode() | translate }}</span>
        </div>
        <div class="offer-details">
          <div class="offer-info">
            <span class="label">{{ currentlang === 'ar' ? 'رقم العرض:' : 'Offer ID:' }}</span>
            <span class="value">#{{ offer.specialOrderOfferId }}</span>
          </div>
          <div class="offer-info">
            <span class="label">{{ currentlang === 'ar' ? 'تاريخ العرض:' : 'Offer Date:' }}</span>
            <span class="value">{{ formatDateTime(offer.creationTime, 'date') }}</span>
          </div>
        </div>
        <div class="offer-actions">
          <button 
            class="accept-offer-btn"
            (click)="acceptOffer(offer)"
            [disabled]="isAcceptingOffer[offer.specialOrderOfferId]"
            [class.accepting]="isAcceptingOffer[offer.specialOrderOfferId]">
            <span *ngIf="!isAcceptingOffer[offer.specialOrderOfferId]">
              <span class="pi pi-check me-1"></span>
              {{ currentlang === 'ar' ? 'قبول العرض' : 'Accept Offer' }}
            </span>
            <span *ngIf="isAcceptingOffer[offer.specialOrderOfferId]" class="accepting-content">
              <span class="spinner"></span>
              {{ currentlang === 'ar' ? 'جاري القبول...' : 'Accepting...' }}
            </span>
          </button>
        </div>
      </div>
    </ng-container>
    
    <ng-template #noOffers>
      <div class="no-offers">
        <span class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></span>
        <p>{{ currentlang === 'ar' ? 'لا توجد عروض متاحة حالياً' : 'No offers available yet' }}</p>
      </div>
    </ng-template>
  </div>
</p-dialog>
